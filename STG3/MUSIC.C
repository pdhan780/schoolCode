#include "music.h"

static int noteCurr = 0;

const struct Note song[] = {
/* bar 1 (21 lines) */
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   25},
/* bar 2 (21 lines) */
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {179, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   25},
/* bar 3 (21 lines) */
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   25},
/* bar 4 (21 lines) */
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {179, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   25},
/* bar 5 (23 lines) */
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   5},
  {239, 5},
  {0,   5},
  {239, 5},
  {0,   5},
/* bar 6 (25 lines) */
  {201, 5},
  {239, 5},
  {201, 5},
  {239, 5},
  {201, 5},
  {169, 5},
  {201, 5},
  {169, 5},
  {127, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {127, 5},
  {0,   5},
  {127, 5},
  {0,   5},
  {127, 5},
  {0,   5},
  {0,   10},
  {119, 15},
  {0,   5},
  {179, 10},
  {239, 10},
/* bar 7 (23 lines) */
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {150, 15},
  {0,   5},
  {179, 7},
  {0,   13},
  {134, 5},
  {0,   5},
  {134, 5},
  {0,   5},
  {134, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   5},
  {201, 15},
  {0,   5},
/* bar 8 (27 lines) */
  {201, 5},
  {239, 5},
  {201, 5},
  {239, 5},
  {201, 5},
  {169, 5},
  {201, 5},
  {169, 5},
  {134, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {127, 5},
  {135, 5},
  {127, 5},
  {135, 5},
  {159, 5},
  {142, 5},
  {127, 5},
  {119, 5},
  {100, 5.666},
  {0,   1},
  {89,  5.666},
  {0,   1},
  {71,  5.666},
  {0,   1},
  {100, 20}

};

  

/*main song on channel A = 0*/
void start_music()
{
	
  int sustain = 10;
  int volume = 11;

  set_envelope(7, sustain);
  
  enable_channel(0, true, false);
  
  set_volume(0, volume);
		
}






bool update_music(UINT32 timeElapsed)

{
	
  bool updated = false;
	
  /*if the clock returns greater/equal than note duration, do next note*/

  if (timeElapsed >= song[noteCurr].duration) {
	  
       noteCurr++;
       updated = true;
  }


  if (noteCurr > (NOTES_SZ - 1)) /*all notes played, restart*/

  {
    noteCurr = 0;


  }


  


  set_tone(0, song[noteCurr].freq);

  return updated;
	
	
	
	
}
